<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./styles.css" />
    <title>beanstalk demo</title>
  </head>
  <body>
    <main class="main">
      <h1 class="title">Node.js in Elastic Beanstalk</h1>
      <form class="formi">
        <div class="form-container">
          <h2>add a person</h2>
          <label for="name">name</label>
          <input type="text" name="name" />
          <label for="age">age</label>
          <input type="number" name="age" />
          <button type="submit">submit</button>
        </div>
      </form>
    </main>
  </body>

  <script>
    function getNameAndAge(search) {
      const spliced = search.substr(1, search.length);
      const parts = spliced.split('&');
      return parts.map((p) => p.split('=')[1]);
    }

    async function doPost() {
      const search = window.location.search;
      if (search) {
        const [name, age] = getNameAndAge(search);
        const res = await fetch('/people', {
          method: 'POST',
          body: JSON.stringify({ name, age }),
          headers: {
            'Content-Type': 'application/json',
          },
        });
        return await res.json();
      } else {
        console.log('nope');
        return {};
      }
    }

    (async function test() {
      const res = await doPost();
      console.log(res);
    })();
  </script>
</html>
